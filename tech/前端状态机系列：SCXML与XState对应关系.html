<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-v2-demo.mrhope.site/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html"><meta property="og:site_name" content="博客"><meta property="og:title" content="前端状态机系列：SCXML与XState对应关系"><meta property="og:type" content="article"><meta property="og:image" content="https://vuepress-theme-hope-v2-demo.mrhope.site/blog/"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="前端状态机系列：SCXML与XState对应关系"><meta property="article:tag" content="状态机"><meta property="article:published_time" content="2022-01-14T00:00:00.000Z"><title>前端状态机系列：SCXML与XState对应关系 | 博客</title><meta name="description" content=" ">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/blog/assets/style.3d72beae.css">
    <link rel="modulepreload" href="/blog/assets/app.773cfef9.js"><link rel="modulepreload" href="/blog/assets/前端状态机系列：SCXML与XState对应关系.html.fb5b019f.js"><link rel="modulepreload" href="/blog/assets/plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/blog/assets/前端状态机系列：SCXML与XState对应关系.html.a04be808.js"><link rel="prefetch" href="/blog/assets/index.html.57d456d9.js"><link rel="prefetch" href="/blog/assets/index.html.8aee2c1a.js"><link rel="prefetch" href="/blog/assets/降低前端业务复杂度新视角：状态机范式.html.368d5c08.js"><link rel="prefetch" href="/blog/assets/404.html.a0ab54bb.js"><link rel="prefetch" href="/blog/assets/index.html.74e2fb82.js"><link rel="prefetch" href="/blog/assets/index.html.b9680657.js"><link rel="prefetch" href="/blog/assets/index.html.89ac09eb.js"><link rel="prefetch" href="/blog/assets/index.html.9bfdeec8.js"><link rel="prefetch" href="/blog/assets/index.html.3e89b829.js"><link rel="prefetch" href="/blog/assets/index.html.0c763be9.js"><link rel="prefetch" href="/blog/assets/index.html.da3e60c5.js"><link rel="prefetch" href="/blog/assets/index.html.77943ede.js"><link rel="prefetch" href="/blog/assets/index.html.1e93708d.js"><link rel="prefetch" href="/blog/assets/index.html.7e940c4e.js"><link rel="prefetch" href="/blog/assets/降低前端业务复杂度新视角：状态机范式.html.0b40acd2.js"><link rel="prefetch" href="/blog/assets/404.html.dd065ecb.js"><link rel="prefetch" href="/blog/assets/index.html.483bed7a.js"><link rel="prefetch" href="/blog/assets/index.html.3c846d26.js"><link rel="prefetch" href="/blog/assets/index.html.35f4075b.js"><link rel="prefetch" href="/blog/assets/index.html.64bdcf24.js"><link rel="prefetch" href="/blog/assets/index.html.55e8711e.js"><link rel="prefetch" href="/blog/assets/index.html.c4a18122.js"><link rel="prefetch" href="/blog/assets/index.html.ae6a5aa9.js"><link rel="prefetch" href="/blog/assets/index.html.dd000b37.js"><link rel="prefetch" href="/blog/assets/auto.f0b8ad4b.js"><link rel="prefetch" href="/blog/assets/index.5470b2f6.js"><link rel="prefetch" href="/blog/assets/flowchart.parse.c8d5341a.js"><link rel="prefetch" href="/blog/assets/mermaid.esm.min.72908bbb.js"><link rel="prefetch" href="/blog/assets/highlight.esm.87b79e05.js"><link rel="prefetch" href="/blog/assets/markdown.esm.45736620.js"><link rel="prefetch" href="/blog/assets/math.esm.2b7d37e9.js"><link rel="prefetch" href="/blog/assets/notes.esm.802ae293.js"><link rel="prefetch" href="/blog/assets/reveal.esm.16efd5a4.js"><link rel="prefetch" href="/blog/assets/search.esm.ff89a46c.js"><link rel="prefetch" href="/blog/assets/zoom.esm.d5422d51.js"><link rel="prefetch" href="/blog/assets/photoswipe.esm.d61c7bb4.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/blog/" class="brand"><img class="logo" src="/blog/logo.svg" alt="博客"><!----><span class="site-name hide-in-pad">博客</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-home"></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/tech/" class="nav-link active" aria-label="技术"><span class="icon iconfont icon-template"></span>技术<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/lecepin/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->前端状态机系列：SCXML与XState对应关系</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年1月14日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">乐平</span></span><span property="author" content="乐平"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年1月14日</span><meta property="datePublished" content="2022-01-14T00:00:00.000Z"></span><!----><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2022年1月14日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag2 clickable" role="navigation">状态机</li></ul><meta property="keywords" content="状态机"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年1月14日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 33 分钟</span><meta property="timeRequired" content="PT33M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_1-1-状态图" class="router-link-active router-link-exact-active toc-link level2">1.1 状态图</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_1-2-scxml" class="router-link-active router-link-exact-active toc-link level2">1.2 SCXML</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_1-3-xstate" class="router-link-active router-link-exact-active toc-link level2">1.3 XState</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_2-1-scxml-的组织" class="router-link-active router-link-exact-active toc-link level2">2.1 SCXML 的组织</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_2-2-xstate-的组织" class="router-link-active router-link-exact-active toc-link level2">2.2 XState 的组织</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-核心元素" class="router-link-active router-link-exact-active toc-link level2">3.1 核心元素</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-1-scxml" class="router-link-active router-link-exact-active toc-link level3">3.1.1 &lt;scxml&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-2-state" class="router-link-active router-link-exact-active toc-link level3">3.1.2 &lt;state&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-3-transition" class="router-link-active router-link-exact-active toc-link level3">3.1.3 &lt;transition&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-4-initial" class="router-link-active router-link-exact-active toc-link level3">3.1.4 &lt;initial&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-5-parallel" class="router-link-active router-link-exact-active toc-link level3">3.1.5 &lt;parallel&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-6-final" class="router-link-active router-link-exact-active toc-link level3">3.1.6 &lt;final&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-7-history" class="router-link-active router-link-exact-active toc-link level3">3.1.7 &lt;history&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-8-onentry" class="router-link-active router-link-exact-active toc-link level3">3.1.8 &lt;onentry&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-1-9-onexit" class="router-link-active router-link-exact-active toc-link level3">3.1.9 &lt;onexit&gt;</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-2-可执行内容" class="router-link-active router-link-exact-active toc-link level2">3.2 可执行内容</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-2-1-raise" class="router-link-active router-link-exact-active toc-link level3">3.2.1 &lt;raise&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-2-2-foreach" class="router-link-active router-link-exact-active toc-link level3">3.2.2 &lt;foreach&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-2-3-log" class="router-link-active router-link-exact-active toc-link level3">3.2.3 &lt;log&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-2-4-if-、-elseif-、-else" class="router-link-active router-link-exact-active toc-link level3">3.2.4 &lt;if&gt;、&lt;elseif&gt;、&lt;else&gt;</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-数据模型和数据操作" class="router-link-active router-link-exact-active toc-link level2">3.3 数据模型和数据操作</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-1-datamodel" class="router-link-active router-link-exact-active toc-link level3">3.3.1 &lt;datamodel&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-2-data" class="router-link-active router-link-exact-active toc-link level3">3.3.2 &lt;data&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-3-assign" class="router-link-active router-link-exact-active toc-link level3">3.3.3 &lt;assign&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-4-script" class="router-link-active router-link-exact-active toc-link level3">3.3.4 &lt;script&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-5-donedata" class="router-link-active router-link-exact-active toc-link level3">3.3.5 &lt;donedata&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-6-param" class="router-link-active router-link-exact-active toc-link level3">3.3.6 &lt;param&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-3-7-content" class="router-link-active router-link-exact-active toc-link level3">3.3.7 &lt;content&gt;</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-4-外部通讯" class="router-link-active router-link-exact-active toc-link level2">3.4 外部通讯</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-4-1-send" class="router-link-active router-link-exact-active toc-link level3">3.4.1 &lt;send&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-4-2-cancel" class="router-link-active router-link-exact-active toc-link level3">3.4.2 &lt;cancel&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-4-3-invoke" class="router-link-active router-link-exact-active toc-link level3">3.4.3 &lt;invoke&gt;</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-4-4-finalize" class="router-link-active router-link-exact-active toc-link level3">3.4.4 &lt;finalize&gt;</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-5-未对应-xstate-api" class="router-link-active router-link-exact-active toc-link level2">3.5 未对应 XState API</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blog/tech/%E5%89%8D%E7%AB%AF%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E5%88%97%EF%BC%9ASCXML%E4%B8%8EXState%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html#_3-6-对应大图" class="router-link-active router-link-exact-active toc-link level2">3.6 对应大图</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p><img src="/blog/assets/1662725997780.dc54f796.webp" alt="" loading="lazy"></p><h1 id="_1-前置说明" tabindex="-1"><a class="header-anchor" href="#_1-前置说明" aria-hidden="true">#</a> 1. 前置说明</h1><p>这次再说明下自己对状态图的看法。状态图虽然有非常多的优势（<a href="https://github.com/lecepin/blog/blob/main/%E9%99%8D%E4%BD%8E%E5%89%8D%E7%AB%AF%E4%B8%9A%E5%8A%A1%E5%A4%8D%E6%9D%82%E5%BA%A6%E6%96%B0%E8%A7%86%E8%A7%92%EF%BC%9A%E7%8A%B6%E6%80%81%E6%9C%BA%E8%8C%83%E5%BC%8F.md" target="_blank" rel="noopener noreferrer">参考上篇文章<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>），如果你想使用，关于是否对整个旧项目进行全量状态图化，这里给一个适应范围是：项目中复杂的部分进行状态图建模是非常合适的。如果你有精力是可以尝试对整个项目进行状态图化的。</p><h2 id="_1-1-状态图" tabindex="-1"><a class="header-anchor" href="#_1-1-状态图" aria-hidden="true">#</a> 1.1 状态图</h2><p>再回顾一下什么是状态图。 状态图的前身是状态机（FSM），FSM 使用过程中会暴露一些问题，如：</p><ul><li>状态爆炸</li><li>层次表达能力弱</li></ul><p>项目复杂起来，到后期 FSM 会很难维护。</p><p>针对这些问题，计算机科学家 David Harel 在 1984 年对 FSM 进行了扩展，发明了 状态图（SC）来解决 FSM 中的问题。（<a href="http://www.inf.ed.ac.uk/teaching/courses/seoc/2005_2006/resources/statecharts.pdf" target="_blank" rel="noopener noreferrer">论文地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）</p><p>SC 不仅仅是更好的可视化了 FSM，而且它是可执行的。现在的大多数状态机工具库，更确切的说应该是状态图工具库。</p><p>SC 定义为一个分层有向图（S，T，R，In，Out），比 FSM 多了一个 R（Orthogonal 正交）的概念。</p><p>SC 设计了一套非常复杂且非常精确的符号系统，增强了结构层次的表达能力和有向图的连通表达能力。目前也是 UML 的首选控制模型。</p><h2 id="_1-2-scxml" tabindex="-1"><a class="header-anchor" href="#_1-2-scxml" aria-hidden="true">#</a> 1.2 SCXML</h2><p>SCXML 全称 State Chart XML，用于控制抽象的状态机表示法。</p><p>SCXML 是基于上面说的 David Harel 状态图 和 CCXML（Call Control eXtensible Markup Language） 进行扩展的一套规范。</p><p>从 2005 年到 2015 年经历 10 年定制的规范，成为 W3C 推荐规范。目前大部分编程语言的状态机工具都是基于此规范实施的。</p><h2 id="_1-3-xstate" tabindex="-1"><a class="header-anchor" href="#_1-3-xstate" aria-hidden="true">#</a> 1.3 XState</h2><p>XState 是一个前端的状态图工具库，由微软工程师 David Khourshid 开发。目前是前端状态机里面 Star 最多的，本人体验下来感觉也很不错（本人很高兴在此仓库贡献了 14.7k 行 ）。下图是 XState Github Star 记录：</p><p><img src="/blog/assets/1662726060504.105e9114.webp" alt="" loading="lazy"></p><h1 id="_2-组织说明" tabindex="-1"><a class="header-anchor" href="#_2-组织说明" aria-hidden="true">#</a> 2. 组织说明</h1><p>XState 的文档写的并不是很好懂，很多概念跳来跳去（当然 大多数国外的文档都有这种问题，作者肯定很想表达清楚，但并不容易做），如果读者对状态机没有概念，突如其来的一堆新的概念会让你措手不及，学习曲线剧增，使用上也不知该如何下手。</p><p>如果想要对这些概念有更好的认识和组织，那用 SCXML 和 XState 去对照着看，或许是比较合适的。</p><h2 id="_2-1-scxml-的组织" tabindex="-1"><a class="header-anchor" href="#_2-1-scxml-的组织" aria-hidden="true">#</a> 2.1 SCXML 的组织</h2><p>主要有以下部分：</p><ul><li>核心 <ul><li><code>&lt;scxml&gt;</code></li><li><code>&lt;state&gt;</code></li><li><code>&lt;transition&gt;</code></li><li><code>&lt;initial&gt;</code></li><li><code>&lt;parallel&gt;</code></li><li><code>&lt;final&gt;</code></li><li><code>&lt;history&gt;</code></li><li><code>&lt;onentry&gt;</code></li><li><code>&lt;onexit&gt;</code></li></ul></li><li>可执行内容 <ul><li><code>&lt;raise&gt;</code></li><li><code>&lt;foreach&gt;</code></li><li><code>&lt;log&gt;</code></li><li><code>&lt;if&gt;</code></li><li><code>&lt;elseif&gt;</code></li><li><code>&lt;else&gt;</code></li></ul></li><li>数据模型和数据操作 <ul><li><code>&lt;datamodel&gt;</code></li><li><code>&lt;data&gt;</code></li><li><code>&lt;content&gt;</code></li><li><code>&lt;param&gt;</code></li><li><code>&lt;donedata&gt;</code></li><li><code>&lt;script&gt;</code></li><li><code>&lt;assign&gt;</code></li></ul></li><li>外部通讯 <ul><li><code>&lt;send&gt;</code></li><li><code>&lt;cancel&gt;</code></li><li><code>&lt;invoke&gt;</code></li><li><code>&lt;finalize&gt;</code></li></ul></li></ul><h2 id="_2-2-xstate-的组织" tabindex="-1"><a class="header-anchor" href="#_2-2-xstate-的组织" aria-hidden="true">#</a> 2.2 XState 的组织</h2><p>主要有以下部分：</p><ul><li>Machine</li><li>State</li><li>State Node</li><li>Event</li><li>Transition</li><li>Parallel State</li><li>Final State</li><li>History State</li><li>Effects <ul><li>Invoke</li><li>Actions <ul><li>send</li><li>raise</li><li>respond</li><li>forwardTo</li><li>escalate</li><li>log</li><li>choose</li><li>pure</li><li>assign</li></ul></li><li>Activities</li></ul></li><li>Context</li><li>Guard</li><li>Delay</li><li>Interpret</li><li>Identify</li><li>Actor</li><li>Model</li></ul><h1 id="_3-对应关系" tabindex="-1"><a class="header-anchor" href="#_3-对应关系" aria-hidden="true">#</a> 3. 对应关系</h1><p>下面以 SCXML 为主线去做对应描述。</p><h2 id="_3-1-核心元素" tabindex="-1"><a class="header-anchor" href="#_3-1-核心元素" aria-hidden="true">#</a> 3.1 核心元素</h2><p>按照 SCXML 的分类，先从核心部分的元素进行对应说明。</p><h3 id="_3-1-1-scxml" tabindex="-1"><a class="header-anchor" href="#_3-1-1-scxml" aria-hidden="true">#</a> 3.1.1 <code>&lt;scxml&gt;</code></h3><p><code>&lt;scxml&gt;</code>，最外层的状态机包裹元素，携带版本信息，状态机是由它的 children 组成的。</p><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>initial</td><td>false</td><td>none</td><td>IDREFS</td><td>none</td><td>合法的状态规范</td><td>状态机的初始状态的 id。如果未指定，则默认初始状态是文档顺序中的第一个子状态</td></tr><tr><td>name</td><td>false</td><td>none</td><td>NMTOKEN</td><td>none</td><td>任何有效的 NMTOKEN</td><td>此状态机的名称。它纯粹是为了提供信息</td></tr><tr><td>xmlns</td><td>true</td><td>none</td><td>URI</td><td>none</td><td><a href="http://www.w3.org/2005/07/scxml" target="_blank" rel="noopener noreferrer">http://www.w3.org/2005/07/scxml<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td></td></tr><tr><td>version</td><td>true</td><td>none</td><td>decimal</td><td>none</td><td>必须 &quot;1.0&quot;</td><td></td></tr><tr><td>datamodel</td><td>false</td><td>none</td><td>NMTOKEN</td><td>platform-specific</td><td>&quot;null&quot;, &quot;ecmascript&quot;, &quot;xpath&quot; 或者其他平台定义的值</td><td>本文档所需的数据模型。 “null”表示 Null 数据模型，“ecmascript”表示 ECMAScript 数据模型，“xpath”表示 XPath 数据模型</td></tr><tr><td>binding</td><td>false</td><td>none</td><td>enum</td><td>&quot;early&quot;</td><td>&quot;early&quot;, &quot;late&quot;</td><td>要使用的数据绑定</td></tr></tbody></table><p>children 可以包含：</p><ul><li><code>&lt;state&gt;</code></li><li><code>&lt;parallel&gt;</code></li><li><code>&lt;final&gt;</code></li><li><code>&lt;datamodel&gt;</code></li><li><code>&lt;script&gt;</code></li></ul><p>对应 XState 是 Machine，Machine 的部分属性描述如下（<a href="https://github.com/statelyai/xstate/blob/xstate%404.27.0/packages/core/src/types.ts#L763" target="_blank" rel="noopener noreferrer">详情<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;initial&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;context&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;states&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-1-2-state" tabindex="-1"><a class="header-anchor" href="#_3-1-2-state" aria-hidden="true">#</a> 3.1.2 <code>&lt;state&gt;</code></h3><p><code>&lt;state&gt;</code>，用来描述状态机中的状态。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>false</td><td>none</td><td>ID</td><td>none</td><td></td><td>状态 ID</td></tr><tr><td>initial</td><td>false</td><td>不得与 <code>&lt;initial&gt;</code> 元素一起指定。绝不能以原子状态出现。</td><td>IDREFS</td><td>none</td><td></td><td>此状态的默认初始状态</td></tr></tbody></table><p>children 可以包含：</p><ul><li><code>&lt;onentry&gt;</code></li><li><code>&lt;onexit&gt;</code></li><li><code>&lt;transition&gt;</code></li><li><code>&lt;initial&gt;</code></li><li><code>&lt;state&gt;</code></li><li><code>&lt;parallel&gt;</code></li><li><code>&lt;final&gt;</code></li><li><code>&lt;history&gt;</code></li><li><code>&lt;datamodel&gt;</code></li><li><code>&lt;invoke&gt;</code></li></ul><p>对应 XState 的 State Node。不过 State Node 是一个 SCXML 多个元素组成的一个属性。由 <code>&lt;state&gt;</code>、<code>&lt;initial&gt;</code>、<code>&lt;parallel&gt;</code>、<code>&lt;final&gt;</code>、<code>&lt;history&gt;</code>组成。</p><p>State Node 的部分属性描述如下（<a href="https://github.com/statelyai/xstate/blob/xstate%404.27.0/packages/core/src/types.ts#L505" target="_blank" rel="noopener noreferrer">详情<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;states&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;invoke&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;on&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;onEntry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;onExit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;onDone&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;always&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;after&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="data:image/webp;base64,UklGRh4PAABXRUJQVlA4IBIPAACwtwCdASokBmIBPpFIn0ylpCMiIFOogLASCWlu4Xf17Y2hoD8AeurRtNPP+R+yH/HfkZ55+SH1N7icg3pP/i9wv8x67v27vf4AXrfdYwAfVbv69SzIA/kv9a/5vHXUAP5t/o/+t6oX1J6APq7p0PX7+8QLbELp3U1ATK3N9TUBMrc31NPMMZtkvVNG0bRtG0bRtG0bRtG0bRtG0bRtCL1hkYzWd67k6ZYy27Hnv5V0POHV5t2PPfyrVmIXTupqAmVub6moCZW5vpu0ohk6qL4K6x7huse4brHuO/MW9LOqizELp3U1ATK3N9TUBMrc31NQEytzfU1ATK3N9TUBMrc31NGIlV2Bdc9fovhZiy/A8LIrcntZnE29p6MLYI9BhMknYPU1ATK3N9TUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEytzcjy/H7Z/bsgDGVRoqyjDRC2wAa/5JNBRlADSuhOTsRjxcDbrq0IWB/YUwPm3z74BkSsCXe6mnm5qZ3U1ATK3N9TUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEysu7ESBHBrAPFHUuPBB/JHFoqfcU/ESUA9IDYbG0GEpJKx4bUAKfRjlYK5zHcnF+BDdR4XHWGS0IXTupqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vqagIxWKZqzERtvqaebmpndTUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEytzfU1ATKy7qyGIRX24PILcHkFuDyC3B5Bbg8gtOkQZWyagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vixFsHqagJlbm+LGsW5vqagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6moCYO7EtCF07qagJg8B1mZiF07qagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6cIlaMmoCZW5vpwloQundTUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEytzfU1ARisWYuwCLc31NPNzUzupqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vqagJlZd2JaB276r5fteuFgiLc3ex2GS0IXTupqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vqagIxWKZq+qRsViKwaaCJ0SF8aD8B1mZiF07qagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6cIlkRpmMsZIm2um3eMwdju6RNAko6gGvHBPnhmgA5NyrTXlKjJL+J5tAxT7aeeO+zLRk1ATK3N9TUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEytzfFiLYPXat9K/EoWnyUbT3e6gWEe/eJUBzo3OybMs1gaSbyJxPQFsoliUlNKdQhGAOerGI/4YShAWARbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vqaebd4DrlKQedA6wOikaRTdHmZs7ewepqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vqagJlbm5Hl/HYsK8Gi+wppFrM7QjlNNHgwpbmpndTUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEytzfU1ATKy7sS0IXTupvVVc7B6moCZW5vqagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVubkeXmpndTUBMrbaAsAi3N9TUBMrc31NQEytzfU1ATK3N9TUBMrc31NQEytzfU0827zgjUBMrc31Lcaxbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6moCZW5vqagJgkUp2WQH0xxmZW5vqaeUvr9GVwEW5vqagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6moBfTRP1UYx8mSZJkmSZJkmSZJkmSZJkmSZJkmMqZWejtWYhdO6moCZW5vqagJlbm+pqAmVub6moCZW5vqagJlbm+pqAmVub6moCZga6zMxC6d1NQEytzfU1ATK3N8QAAD+/+OdAH965x9ShaA+CIOtog0a9eCI7FCf/ZGckxjb7I7n8mz/s0FtbtfkDbAx6RxdXWeb6NP6bzt/8w7ly+4n9cxnvNIFDQ9txomnrs5mXZzMuzmZdnMy7OZl2czLs5mXZzMuzmZdnMy7OZl2czLs5mXZzMuzmZdnMy7OZl2czLhQN3VQIYC5q8AvEvaEfnzl7O1aZ/xh6FBSGBLgrhTWiuT72Uem+hQONdbU8zeYp5leK6D3mGXVRJqp7eZJuESamXVlL/yRJrJuJS/M5jK8PylMF0GyvDM5m8xTzK8V0HvMWDVdjjZKcMNDsQrETyL/2BizoC8XnWXy+e2yStuYUAAAAAAAE6vSpOl8tBzQjyZv48jLTlWt1S4R6UUJFd7NhmAY+7BLSKDrIhk4kuwvRf+ZI6aV3eRH+fzt1leiN6I1DoHPJbsz+K5JFNi3Fu1rlRj6PW+4FRHwK/gt74qPBYbb8jEVH+X5vOdQzZyDdFAcUfz4dn/6Ct3Z3Pjbm/v4pIGzXZ6OB8dWI+ec3Xj8S/9bx4cjR7Bc2aQ7X0IuHDUd8DkcJeaa51muYQDtv6effyzIyr0DjjZkqqIM8SAHLqYwyocAAC9wWSMLQgETzmUGL7FR/m/uMc8kMTXRX8wiekz+MxLvj4G9/+MCW9tnJqTKBJKc2SGd0vUxHzCYzmijiNiVhAwcEOqvra4v9+Uha2PJbB1XiN0xZpArWz7qAfprsDqHZPaNA6668pIJ7AP8Ofm6gtn291FvGnVI9ZpiBAl87xPmj+xlpUqKqsSrctU2+L84PHYWICFypH3L2c5mXMLQrrRgU6ckYtH34f13PGE5sK0A7nrTJANRKTu+ENotQknNKHP+AsoMQzkku8m7ClcyUYBNlQLXds21Ip4ZYuGImsf2Aai7PBH2IOl7HPdMmH+7MyZAYAaaIHJ7YkUhNZ6DzH5h/aiWM3V3VF8t0UxpEIqXGkRu++Qehv48tJYCsXzIJokffqyfNC1Ihl46IP7zHfZvzTz148Ip2X1KV3kU4uKs3UJfSE1PZnrRgV4WBwrV6ehKnKYVA6zFAxKJE859ytja02GvHFtpGNnYn5bRCAKod7SntOruEsJV0uvzBGkHpyhkW4lD0pEI9pohpL+7MsQT3/T0ak24S1zI+cDQMotW3nn1T/UEiSclz/uS+36+WwjkZmz88LGcruGrTHrZ5hwP3T8cOK/7g2d2VoSzKJCaEwFtUcAADTFh2b71yKgJ8DgZ+b1jLZk8txY/v0ntm6E61/4aA9PzlXjbf5w8Y5sxXhb2OcJrUfwcjdIZii2Zz/vPXmuDJen6K80MfC117THTlSO7USCltquFTFpKdkG7f88q9M5udE2TXSXulElE1Fqa0Y6KuiSMGQ4hID+kchKoIJefL0umkXYJhK9AyB9d3SkYqKTREVcrgedw0SGVAR0a5HXwLP+thEH6NmkVbUYafEd7aP4MobS4i3tQ2vW9UwcX9n9w/Gz0SOd71vhXylwcSw+sK2gcB2D1xa6QNHjaX2JkAhsa76uv0FgElXFyk7Rsm/lSaR8jkVhjITPAnf7i4Hh+EjSCNgY6vac+i5J5PdYxLX5vU11SXbMDK54ukXZNQvUD+5hH9TFwu43+OLdOO/nxVzny1Y2cl4fzbHe3xvf1foLPLo5stVILR9MOX6SOpOeNpCjUgFVvJhIHOx3+SZSne2Z2FweFYL4FTEbHTNeW2SKFRiKX80o6YzV3APkL63IaPpkZu2UFAAAksz0pBi5ubAgAA1gdkI4+hy1WVH51flraj5B7viRpebpQZGOAABxAApAGB4lDghg/JGuwAACtJBncMAAATMnZLUUAAB1kn9Uu66YAAEDDIo8o0aom79TV2AAAnARI+VsF1bmANmU9EiBuwIZjtoAc9s/OKFIrXanuhVx2GFwD838oukx58elYY49qGiyhvWhDAAAFoSs65kqhCNFypw4GqhS0+UlEnUs79wpgE97qfhdisKGkZNob3rUBZAjO/SJMiNIDGsyDKE/1prwK5wJ/P7KhkDWkMdgapsdMYcRgvktnOOsmW/HRZcmMrUpPgmtgHOhWH/RbRz4E/HqwYOrSBbpRmt9Rfwo3HSwT64PZVmvyyj606q8ljK/lYsqzwSYa359TV6S2Bfz83DA8pO9hy7arY8eIkgqOM38wZzsGiiq2y5yBO90zBIN1QAFmV7lLeANJKjFrDt1UclyTQKvsBzV27qFkXNBDsFQWcaFJti4qiKbhlWoj7hs+wh1Av0yUTkx8/G2tzIH6zT3WoC5ZeNb9d70OEfmubYCo4EBPlSLzqcXSQMxzeJ5cmVTuXjx9KFMjVQ7aS3Rs6cefg5gspOg56/9aPizopVwYgC9LUUAABbIXAGOIWGJNHolj+47tuYaaGwbYxdnOOPSs+71mc5M+ZtXU5j6qYkrF9Iw7sb3AB64UVe/m3fDWYr/RrqIQAj9t9iVXN5lXggI8IJqXCSuDcKE0k1fyn+A2H+f4HeKjcBjzb1hJLaaBzIbEsJOUM2e1DTJZXjliniXvfzP8FocTZ+hPtXfWMMtRIU2rzuPc6fxw5RtbwUP0OojhyWcRjeFLXG2PIqeC1RJPZpHAycVJx8wsOQXwUUrKcwWPyaSSFqZZxglPNTuHq/ZNX5MRDMkSt/HfisQyQUMeEohrmajiTQKoDKMsC5HdCwzRfONEsnPpXVAf9gwWpWioevuUSRcq6Hc4hCZiU9JPFm291CDxg6d+WU2yvkXynfqc57XWZKE7K8KTxcOtGMpOeC6CI8eaB/91pgYNVCmKLEE4XSCY0sp1Q4C/Fec/DmfOx8J5tlzTHRY6B1vOOIs3NTTHtSWVIx0Q2Ve7v7Afh38/X20ufFSGvII8z5wUrEcWE+XUl3XTAAAjhWrQskrzP5eTHf/sgfyy0ZfgUTS0ASxqkmCbwkHxDOPimg0Nzs2gbF7cjCK+gASldgAALYlQdCUT16QXKELXYAAC2QRdy1FAAAY/xVJd10wAAKbGairsAAAkSCVNfvAOtYz9Y68xqwBFsAWBXoP36Xi99xDc6idrAAaAAADT7/M8ecK8lZStSBx+FvjrvGvz35/yQWLSaJaV6UekS4Oj2EHwIPgQfAg+BB8CD4EHwF2y8dv7zUcn0ggs7loRMBCaGFhHd91JIAAAAAAAAAA=" alt="" loading="lazy"></p><h3 id="_3-1-3-transition" tabindex="-1"><a class="header-anchor" href="#_3-1-3-transition" aria-hidden="true">#</a> 3.1.3 <code>&lt;transition&gt;</code></h3><p>状态之间进行转换。由事件触发，通过条件判断后进行转换。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>打开<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_event.data==1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>点击<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>关闭<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>关闭<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>event</td><td>false</td><td></td><td>EventsTypes.datatype</td><td>none</td><td>以空格分隔的事件描述符列表</td><td>触发此转换的事件指示符列表</td></tr><tr><td>cond</td><td>false</td><td></td><td>Boolean expression</td><td>&#39;true&#39;</td><td>布尔表达式</td><td>转换条件</td></tr><tr><td>target</td><td>false</td><td></td><td>IDREFS</td><td>none</td><td>要跳转到的状态</td><td>要转换到的状态或并行区域的标识符</td></tr><tr><td>type</td><td>false</td><td></td><td>enum</td><td>&quot;external&quot;</td><td>&quot;internal&quot; &quot;external&quot;</td><td>确定目标状态是来自于内部转换还是外部转换</td></tr></tbody></table><p>children 可以包含 可执行内容。</p><p>对应 XState 的 Event、Transition、Guard。部分属性描述如下（<a href="https://github.com/statelyai/xstate/blob/xstate%404.27.0/packages/core/src/types.ts#L445" target="_blank" rel="noopener noreferrer">详情<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;on&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;*&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;自定义事件&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;目标状态&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;cond&quot;</span><span class="token operator">:</span> <span class="token string">&quot;条件判断&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;actions&quot;</span><span class="token operator">:</span> <span class="token string">&quot;可执行内容&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;in&quot;</span><span class="token operator">:</span> <span class="token string">&quot;只能从这个状态过来&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;internal&quot;</span><span class="token operator">:</span> <span class="token string">&quot;内部转换&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;meta&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">打开</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">点击</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;关闭&quot;</span><span class="token punctuation">,</span>
          <span class="token function-variable function">cond</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">关闭</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726150855.63964666.webp" alt="" loading="lazy"></p><h3 id="_3-1-4-initial" tabindex="-1"><a class="header-anchor" href="#_3-1-4-initial" aria-hidden="true">#</a> 3.1.4 <code>&lt;initial&gt;</code></h3><p><code>&lt;initial&gt;</code>，表示复杂 <code>&lt;state&gt;</code> 元素（即包含子 <code>&lt;state&gt;</code> 或 <code>&lt;parallel&gt;</code> 元素的元素）的默认初始状态。并不是一个状态，只是一个指向状态的作用。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>打开<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initial</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>写入<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>initial</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>写入<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>读取<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>必须和 <code>&lt;transition&gt;</code> 一起使用，进行状态指定。</p><p>children 包含 <code>&lt;transition&gt;</code>。</p><p>XState 可以直接在 State Node 的 <code>initail</code> 进行指定实现。</p><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">打开</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;读取&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">读取</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">写入</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726180713.d1c01944.webp" alt="" loading="lazy"></p><h3 id="_3-1-5-parallel" tabindex="-1"><a class="header-anchor" href="#_3-1-5-parallel" aria-hidden="true">#</a> 3.1.5 <code>&lt;parallel&gt;</code></h3><p>该元素表示一个状态，其子项并行执行。当父元素处于活动状态时，子项同时处于活动状态。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parallel</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>网盘<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>写入<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>读取<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parallel</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>false</td><td>none</td><td>ID</td><td>none</td><td>XML Schema 中定义的有效 id</td><td>状态 ID</td></tr></tbody></table><p>children 可以包含：</p><ul><li><code>&lt;onentry&gt;</code></li><li><code>&lt;onexit&gt;</code></li><li><code>&lt;transition&gt;</code></li><li><code>&lt;state&gt;</code></li><li><code>&lt;parallel&gt;</code></li><li><code>&lt;history&gt;</code></li><li><code>&lt;datamodel&gt;</code></li><li><code>&lt;invoke&gt;</code></li></ul><p>XState 可以直接在 State Node 的 <code>type: parallel</code> 进行指定实现。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>网盘<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parallel</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>网盘<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>上传<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initial</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>空闲<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>initial</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>空闲<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>上传中<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>开始<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>上传中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>成功<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完在<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>成功<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initial</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载.空闲<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>initial</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载.空闲<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载.下载中<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>开始<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载.下载中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载.成功<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完在<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载.成功<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parallel</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;网盘&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">网盘</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;parallel&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">下载</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;空闲&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">空闲</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">开始</span><span class="token operator">:</span> <span class="token string">&quot;下载中&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">下载中</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">完成</span><span class="token operator">:</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">成功</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">上传</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;空闲&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">空闲</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">开始</span><span class="token operator">:</span> <span class="token string">&quot;上传中&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">上传中</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">完成</span><span class="token operator">:</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">成功</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726212898.64487297.webp" alt="" loading="lazy"></p><h3 id="_3-1-6-final" tabindex="-1"><a class="header-anchor" href="#_3-1-6-final" aria-hidden="true">#</a> 3.1.6 <code>&lt;final&gt;</code></h3><p><code>&lt;final&gt;</code> 表示 <code>&lt;scxml&gt;</code> 或复合 <code>&lt;state&gt;</code> 元素的最终状态。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下载中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完成<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>成功<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>成功<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>false</td><td>none</td><td>ID</td><td>none</td><td>XML Schema 中定义的有效 id</td><td>状态 ID</td></tr></tbody></table><p>children 可以包含：</p><ul><li><code>&lt;onentry&gt;</code></li><li><code>&lt;onexit&gt;</code></li><li><code>&lt;donedata&gt;</code></li></ul><p>XState 可以直接在 State Node 的 <code>type: final</code> 进行指定实现。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initial</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>工作<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>initial</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>工作<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initial</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>正在完成任务<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>initial</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 子状态为 final 时，父状态触发 don.state 事件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>done.state.工作<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>工作完成<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>正在完成任务<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完成<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>任务完成<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>任务完成<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>工作完成<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;工作&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">工作</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;正在完成任务&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">正在完成任务</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">完成</span><span class="token operator">:</span> <span class="token string">&quot;任务完成&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">任务完成</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;final&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">onDone</span><span class="token operator">:</span> <span class="token string">&quot;工作完成&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">工作完成</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726239563.3657261c.webp" alt="" loading="lazy"></p><h3 id="_3-1-7-history" tabindex="-1"><a class="header-anchor" href="#_3-1-7-history" aria-hidden="true">#</a> 3.1.7 <code>&lt;history&gt;</code></h3><p><code>&lt;history&gt;</code> 伪状态允许状态机记住它的状态配置。以 <code>&lt;history&gt;</code> 状态为目标的 <code>&lt;transition&gt;</code> 会将状态机返回到此记录的配置。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>history</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>历史状态<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shallow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>history</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>false</td><td>none</td><td>ID</td><td>none</td><td>XML Schema 中定义的有效 id</td><td>状态 ID</td></tr><tr><td>type</td><td>false</td><td>none</td><td>enum</td><td>&quot;shallow&quot;</td><td>&quot;deep&quot; 或 &quot;shallow&quot;</td><td>确定是记录当前状态的活动原子子状态还是仅记录其直接活动子状态。</td></tr></tbody></table><p>children 可以包含 <code>&lt;transition&gt;</code>。</p><p><code>&lt;transition&gt;</code> &#39;target&#39; 指定默认历史配置的转换。 仅发生一次。 在符合标准的 SCXML 文档中，此转换不得包含“cond”或“事件”属性，并且必须指定一个非空“target”。此转换可能包含可执行内容。 如果 &#39;type&#39; 是“shallow”，那么这个 <code>&lt;transition&gt;</code> 的 &#39;target&#39; 必须只包含父状态的直接子级。 否则，它必须只包含父级的后代。</p><p>XState 可以直接在 State Node 的 <code>type: history</code> 进行指定实现。多了一些额外属性：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;history&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;history&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shallow&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;默认指定到父状态&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>新建<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>新建<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>initial</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>编写中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>initial</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>中断<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>暂停<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>编写中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>预览中<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下一步<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>预览中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交中<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>下一步<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>history</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>历史状态<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shallow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>history</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>中断<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>历史状态<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>恢复<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;新建&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">新建</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;编写中&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">暂停</span><span class="token operator">:</span> <span class="token string">&quot;中断&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">编写中</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">下一步</span><span class="token operator">:</span> <span class="token string">&quot;预览中&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">预览中</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">下一步</span><span class="token operator">:</span> <span class="token string">&quot;提交中&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">提交中</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">历史状态</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;history&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">中断</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">恢复</span><span class="token operator">:</span> <span class="token string">&quot;新建.历史状态&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726294380.3d4f18ad.webp" alt="" loading="lazy"></p><h3 id="_3-1-8-onentry" tabindex="-1"><a class="header-anchor" href="#_3-1-8-onentry" aria-hidden="true">#</a> 3.1.8 <code>&lt;onentry&gt;</code></h3><p><code>&lt;onentry&gt;</code>，一个包装元素，包含进入状态时要执行的可执行内容。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>欢迎进入状态A&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同 <code>&lt;transition&gt;</code>，children 只能包含 可执行内容。</p><p>XState 可以直接在 State Node 的 <code>onEntry</code> 进行定义。</p><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;欢迎进入状态A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726319635.fa2fbbf3.webp" alt="" loading="lazy"></p><h3 id="_3-1-9-onexit" tabindex="-1"><a class="header-anchor" href="#_3-1-9-onexit" aria-hidden="true">#</a> 3.1.9 <code>&lt;onexit&gt;</code></h3><p><code>&lt;onexit&gt;</code>，一个包装元素，包含退出状态时要执行的可执行内容。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onexit</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>欢迎下次再来状态A&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onexit</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同 <code>&lt;transition&gt;</code>，children 只能包含 可执行内容。</p><p>XState 可以直接在 State Node 的 <code>onExit</code> 进行定义。</p><p>示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onExit</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;欢迎下次再来状态A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726354370.18efe4f1.webp" alt="" loading="lazy"></p><h2 id="_3-2-可执行内容" tabindex="-1"><a class="header-anchor" href="#_3-2-可执行内容" aria-hidden="true">#</a> 3.2 可执行内容</h2><p>可执行内容，只能在 <code>&lt;onentry&gt;</code>、<code>&lt;onexit&gt;</code> 和 <code>&lt;transition&gt;</code> 中使用。它提供了允许 SCXML 会话修改其数据模型并与外部实体交互的钩子。</p><p>不仅包括了 <code>&lt;raise&gt;</code>、<code>&lt;foreach&gt;</code>、<code>&lt;log&gt;</code>、<code>&lt;if&gt;</code>、<code>&lt;elseif&gt;</code>、<code>&lt;else&gt;</code>，还包含了其他分组下的 <code>&lt;script&gt;</code> 、<code>&lt;assign&gt;</code>、<code>&lt;send&gt;</code> 、<code>&lt;cancel&gt;</code>。当然 下面我们还是按照规范文档中的分类进行对应说明。</p><p>在 XState 中，所有的在 SCXML 中的“可执行内容”统称为 action。所以对应的这些“可执行内容”都在 XState 的 actions 包中。</p><h3 id="_3-2-1-raise" tabindex="-1"><a class="header-anchor" href="#_3-2-1-raise" aria-hidden="true">#</a> 3.2.1 <code>&lt;raise&gt;</code></h3><p><code>&lt;raise&gt;</code> 元素在当前 SCXML 会话中引发一个事件。可以触发 <code>&lt;transition&gt;</code> 中的 event。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>raise</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>event</td><td>true</td><td></td><td>NMTOKEN</td><td>none</td><td></td><td>指定事件的名称。这将与转换的“event”属性相匹配。</td></tr></tbody></table><p>对应 XState 的 <code>actions.raise</code> 函数。示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态B<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>raise</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态B<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">raise</span><span class="token punctuation">(</span><span class="token string">&quot;跳转&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">跳转</span><span class="token operator">:</span> <span class="token string">&quot;状态B&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    状态<span class="token constant">B</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726381568.6f174e47.webp" alt="" loading="lazy"></p><h3 id="_3-2-2-foreach" tabindex="-1"><a class="header-anchor" href="#_3-2-2-foreach" aria-hidden="true">#</a> 3.2.2 <code>&lt;foreach&gt;</code></h3><p><code>&lt;foreach&gt;</code> 元素允许 SCXML 应用程序遍历 <code>&lt;datamodel&gt;</code> 中的集合，并为集合中的每个项目执行其中包含的 可执行内容。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datamodel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[ 10, 20, 30 ]<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataArr<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datamodel</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">array</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataArr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>varIndex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>varItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>varIndex<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>varItem<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>array</td><td>true</td><td></td><td>Value expression</td><td>none</td><td>计算结果为可迭代集合的值表达式 <code>&lt;foreach&gt;</code></td><td>元素将遍历此集合的浅表副本</td></tr><tr><td>item</td><td>true</td><td></td><td>xsd:string</td><td>none</td><td>在指定数 <code>&lt;datamodel&gt;</code> 中有效的任何变量名</td><td>在循环的每次迭代中存储集合的不同项的变量</td></tr><tr><td>index</td><td>false</td><td></td><td>xsd:string</td><td>none</td><td>在指定数 <code>&lt;datamodel&gt;</code> 中有效的任何变量名</td><td>在 foreach 循环的每次迭代中存储当前迭代索引的变量</td></tr></tbody></table><p>children 由一个或多个 可执行内容组成。</p><p>可以对应 XState 的 <code>actions.pure</code> 函数，它也可以返回一个或者一组 action，或者什么也不返回。当然这个函数更灵活。示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dataArr</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">pure</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span>dataArr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">varItem<span class="token punctuation">,</span> varIndex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          _actions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>varIndex<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          _actions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>varItem<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> _actions<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726420494.d05e4f04.webp" alt="" loading="lazy"></p><h3 id="_3-2-3-log" tabindex="-1"><a class="header-anchor" href="#_3-2-3-log" aria-hidden="true">#</a> 3.2.3 <code>&lt;log&gt;</code></h3><p><code>&lt;log&gt;</code> 允许应用程序生成日志记录或调试消息。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>欢迎进入状态A&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>label</td><td>false</td><td></td><td>string</td><td>空字符串</td><td></td><td>具有依赖于实现的解释的字符串。它旨在提供有关“expr”指定的日志字符串的元数据。</td></tr><tr><td>expr</td><td>false</td><td></td><td>值表达式</td><td>none</td><td></td><td>返回要记录的值的表达式</td></tr></tbody></table><p>对应 XState 的 <code>actions.log</code>。示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;欢迎进入状态A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726319635.fa2fbbf3.webp" alt="" loading="lazy"></p><h3 id="_3-2-4-if-、-elseif-、-else" tabindex="-1"><a class="header-anchor" href="#_3-2-4-if-、-elseif-、-else" aria-hidden="true">#</a> 3.2.4 <code>&lt;if&gt;</code>、<code>&lt;elseif&gt;</code>、<code>&lt;else&gt;</code></h3><p><code>&lt;if&gt;</code> 是条件执行元素的容器。 <code>&lt;elseif&gt;</code> 是一个空元素，它对 <code>&lt;if&gt;</code> 的内容进行分区，并提供一个判断是否执行分区的条件。 <code>&lt;else&gt;</code> 是一个空元素，用于划分 <code>&lt;if&gt;</code> 的内容。它等价于一个带有“cond”的 <code>&lt;elseif&gt;</code>，它总是计算为真。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cond1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>cond1==true&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elseif</span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cond2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>cond2==true&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elseif</span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cond3<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>cond3==true&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>else</span> <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>其他情况&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>cond</td><td>true</td><td></td><td>条件表达式</td><td>none</td><td>有效的条件表达式</td><td>一个布尔表达式</td></tr></tbody></table><p>XState 中有很多方法可以实现类似的能力，如果非要对标的话就是 <code>actions.choose</code> 函数了。示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datamodel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datamodel</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value == 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value === 1&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>elseif</span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value == 2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value === 2&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>else</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value != 1 &amp;&amp; value != 2&#39;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">choose</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token function-variable function">cond</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span>actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;value === 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">cond</span><span class="token operator">:</span> <span class="token string">&quot;equal2&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span>actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;value === 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">[</span>actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;value != 1 &amp;&amp; value != 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">guards</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">equal2</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726481551.ac080a18.webp" alt="" loading="lazy"></p><h2 id="_3-3-数据模型和数据操作" tabindex="-1"><a class="header-anchor" href="#_3-3-数据模型和数据操作" aria-hidden="true">#</a> 3.3 数据模型和数据操作</h2><p>这部分是状态之外的数据部分的定义和操作。</p><p>数据模型通过 <code>&lt;datamodel&gt;</code> 元素定义，该元素包含零个或多个 <code>&lt;data&gt;</code> 元素，每个元素定义一个数据元素并为其分配一个初始值。 这些值可以在线指定或从外部源加载。 然后可以通过 <code>&lt;assign&gt;</code> 元素更新它们。 <code>&lt;donedata&gt;</code>、<code>&lt;content&gt;</code> 和 <code>&lt;param&gt;</code> 元素可用于将数据合并到与外部实体的通信中。 最后，<code>&lt;script&gt;</code> 元素允许结合脚本。</p><h3 id="_3-3-1-datamodel" tabindex="-1"><a class="header-anchor" href="#_3-3-1-datamodel" aria-hidden="true">#</a> 3.3.1 <code>&lt;datamodel&gt;</code></h3><p><code>&lt;datamodel&gt;</code> 是一个包装器元素，它封装了任意数量的 <code>&lt;data&gt;</code> 元素，每个元素都定义了一个数据对象。</p><p>children 只能包含 <code>&lt;data&gt;</code>。</p><p>对应 XState 的顶层 <code>context</code>。</p><h3 id="_3-3-2-data" tabindex="-1"><a class="header-anchor" href="#_3-3-2-data" aria-hidden="true">#</a> 3.3.2 <code>&lt;data&gt;</code></h3><p><code>&lt;data&gt;</code> 元素用于声明和填充数据模型的部分。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datamodel</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarBool<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarInt<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>这是字符串&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarString<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datamodel</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>true</td><td></td><td>ID</td><td>none</td><td></td><td>数据项的名称</td></tr><tr><td>src</td><td>false</td><td></td><td>URI</td><td>none</td><td></td><td>给出应从中获取数据对象的位置</td></tr><tr><td>expr</td><td>false</td><td></td><td>Expression</td><td>none</td><td>有效的条件表达式</td><td>执行以提供数据项的值</td></tr></tbody></table><p>在符合标准的 SCXML 文档中，<code>&lt;data&gt;</code> 元素可以具有“src”或“expr”属性，但不能 同时具有。此外，如果任一属性存在，<code>&lt;data&gt;</code> 元素 绝不能有 children。因此，&#39;src&#39;、&#39;expr&#39; 和 children 在 <code>&lt;data&gt;</code> 元素中是互斥的。</p><p>在 XState 中直接作为 <code>context</code> 字段的值存在。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datamodel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarBool<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarInt<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>这是字符串&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarString<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datamodel</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarBool<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarInt<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarString<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">varBool</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">varInt</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">varString</span><span class="token operator">:</span> <span class="token string">&quot;这是字符串&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>varBool<span class="token punctuation">)</span><span class="token punctuation">,</span>
        actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>varInt<span class="token punctuation">)</span><span class="token punctuation">,</span>
        actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>varString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726509775.632efee1.webp" alt="" loading="lazy"></p><h3 id="_3-3-3-assign" tabindex="-1"><a class="header-anchor" href="#_3-3-3-assign" aria-hidden="true">#</a> 3.3.3 <code>&lt;assign&gt;</code></h3><p><code>&lt;assign&gt;</code> 元素用于修改数据模型。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assign</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Var1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>location</td><td>true</td><td></td><td>路径表达式</td><td>none</td><td>有效的路径表达式</td><td>数据模型中要插入新值的位置</td></tr><tr><td>expr</td><td>false</td><td>此属性不得出现在具有子元素的 <code>&lt;assign&gt;</code> 元素中</td><td>值表达</td><td>none</td><td>有效的值表达式</td><td>返回要分配的值的表达式</td></tr></tbody></table><p>在 XState 中用 <code>actions.assign</code> 函数表示。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datamodel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarInt<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>这是字符串&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarString<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datamodel</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assign</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarInt<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assign</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>新的字符串&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarString<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">varInt</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">varString</span><span class="token operator">:</span> <span class="token string">&quot;这是字符串&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">varInt</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token literal-property property">varString</span><span class="token operator">:</span> <span class="token string">&quot;新的字符串&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726535295.b8550ed6.webp" alt="" loading="lazy"></p><h3 id="_3-3-4-script" tabindex="-1"><a class="header-anchor" href="#_3-3-4-script" aria-hidden="true">#</a> 3.3.4 <code>&lt;script&gt;</code></h3><p><code>&lt;script&gt;</code> 元素将脚本功能添加到状态机。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>console.log(&#39;Hello, world!&#39;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>src</td><td>false</td><td>如果元素有子元素，则可能不会发生</td><td></td><td>none</td><td>有效的 URI</td><td>给出应该下载脚本的位置</td></tr></tbody></table><p><code>&lt;script&gt;</code> 元素的 children 内容表示要执行的脚本代码。</p><p>XState 在很多地方可以表达类似的能力，如 actions 属性是支持直接赋值函数的，在 <code>actions.log</code>、<code>actions.pure</code>、<code>actions.assign</code> 等函数都可以实现类似能力。</p><h3 id="_3-3-5-donedata" tabindex="-1"><a class="header-anchor" href="#_3-3-5-donedata" aria-hidden="true">#</a> 3.3.5 <code>&lt;donedata&gt;</code></h3><p>一个包装元素，保存进入 <code>&lt;final&gt;</code> 状态时要返回的数据。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>最终状态<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>donedata</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value1&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value2&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>donedata</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>children 可以包含：</p><ul><li><code>&lt;content&gt;</code>：可以出现 0 次或 1 次。</li><li><code>&lt;param&gt;</code>：可以出现 0 次或多次。</li></ul><p>一个符合标准的 SCXML 文档必须指定单个 <code>&lt;content&gt;</code> 元素或一个或多个 <code>&lt;param&gt;</code> 元素作为 <code>&lt;donedata&gt;</code> 的子元素，但不能同时指定两者。 如果 SCXML 处理器在进入最终状态时生成“done”事件，它必须执行 <code>&lt;donedata&gt;</code> 元素 <code>&lt;param&gt;</code> 或 <code>&lt;content&gt;</code> 子元素并将结果数据放在 <code>_event.data</code> 字段中。</p><p>对应到 XState State Node 的 <code>data</code> 属性字段。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态B<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>done.state.状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_event.data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>donedata</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finalCustomeData1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finalCustomeData2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>donedata</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态B<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A1&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">onDone</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">actions</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;状态B&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        状态<span class="token constant">A1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;final&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">finalCustomeData1</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">finalCustomeData2</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    状态<span class="token constant">B</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726558121.7dd2e110.webp" alt="" loading="lazy"></p><h3 id="_3-3-6-param" tabindex="-1"><a class="header-anchor" href="#_3-3-6-param" aria-hidden="true">#</a> 3.3.6 <code>&lt;param&gt;</code></h3><p><code>&lt;param&gt;</code> 标签提供了一种识别键和动态计算值的通用方法，该值可以传递给外部服务或包含在事件中。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>最终状态<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>donedata</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value1&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>value2&#39;<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>donedata</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>name</td><td>true</td><td></td><td>NMTOKEN</td><td>none</td><td>字符串</td><td></td></tr><tr><td>expr</td><td>false</td><td></td><td>值表达式</td><td>none</td><td>有效值表达式</td><td></td></tr><tr><td>location</td><td>false</td><td></td><td>位置表达式</td><td>none</td><td>有效位置表达式</td><td></td></tr></tbody></table><p>类似于一个 key 一个 value 的方式定义事件数据。</p><p>XState 比较灵活，直接在事件返回处填写 Object 即可。</p><h3 id="_3-3-7-content" tabindex="-1"><a class="header-anchor" href="#_3-3-7-content" aria-hidden="true">#</a> 3.3.7 <code>&lt;content&gt;</code></h3><p>包含要传递给外部服务的数据的容器元素。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>最终状态<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>donedata</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>content</span><span class="token punctuation">&gt;</span></span>{key1: &#39;value1&#39;, key2: &#39;value2&#39;}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>content</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>donedata</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>expr</td><td>false</td><td>不得与子内容一起出现</td><td>值表达式</td><td>none</td><td>有效值表达式</td><td></td></tr></tbody></table><p>如果“expr”属性不存在，处理器必须使用 <code>&lt;content&gt;</code> 的子元素作为输出。</p><p>类似于一个 Object 的方式定义事件数据。功能和 <code>&lt;param&gt;</code> 相似。可以在 <code>&lt;donedata&gt;</code>、<code>&lt;send&gt;</code>、<code>&lt;invoke&gt;</code> 中使用。</p><p>XState 比较灵活，直接在事件返回处填写 Object 即可。</p><h2 id="_3-4-外部通讯" tabindex="-1"><a class="header-anchor" href="#_3-4-外部通讯" aria-hidden="true">#</a> 3.4 外部通讯</h2><p>外部通信功能允许 SCXML 会话从外部实体发送和接收事件，并调用外部服务。</p><h3 id="_3-4-1-send" tabindex="-1"><a class="header-anchor" href="#_3-4-1-send" aria-hidden="true">#</a> 3.4.1 <code>&lt;send&gt;</code></h3><p><code>&lt;send&gt;</code> 用于将事件和数据发送到外部系统，包括外部 SCXML 解释器，或在当前 SCXML 会话中引发事件。提供“即发即弃”的能力。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>event</td><td>false</td><td>不得与“eventexpr”一起出现</td><td>EventType.datatype</td><td>none</td><td></td><td>一个字符串，指示正在生成的消息的名称</td></tr><tr><td>eventexpr</td><td>false</td><td>不得与“event”一起出现</td><td>值表达式</td><td>none</td><td></td><td>“event”的动态替代方案。如果此属性存在，SCXML 处理器必须在执行父 <code>&lt;send&gt;</code> 元素时对其进行执行，并将结果视为已作为“event”的值输入</td></tr><tr><td>target</td><td>false</td><td>不能与“targetexpr”一起出现</td><td>URI</td><td>none</td><td>有效的目标 URI</td><td>平台应将事件发送到的消息目标的唯一标识符</td></tr><tr><td>targetexpr</td><td>false</td><td>不能与“target”一起出现</td><td>值表达式</td><td>none</td><td>有效目标 URI 的表达式</td><td>“target”的动态替代方案。如果存在此属性，则 SCXML 处理器必须在执行父 <code>&lt;send&gt;</code> 元素时对其进行执行，并将结果视为已作为“target”的值输入</td></tr><tr><td>type</td><td>false</td><td>不能与“typeexpr”一起出现</td><td>URI</td><td>none</td><td></td><td>标识消息传输机制的 URI</td></tr><tr><td>typeexpr</td><td>false</td><td>不能与“type”一起出现</td><td>值表达式</td><td>none</td><td></td><td>“type”的动态替代方案。如果此属性存在，SCXML 处理器必须在执行父 <code>&lt;send&gt;</code> 元素时对其进行执行，并将结果视为已作为“type”值输入</td></tr><tr><td>id</td><td>false</td><td>不得与“idlocation”一起出现</td><td>xml:ID</td><td>none</td><td></td><td>要用作此 <code>&lt;send&gt;</code> 实例的标识符的字符串文字</td></tr><tr><td>idlocation</td><td>false</td><td>不得与“id”一起出现</td><td>位置表达式</td><td>none</td><td></td><td>任何位置表达式执行为可以存储系统生成的 id 的数据模型位置</td></tr><tr><td>delay</td><td>false</td><td>不能与“delayexpr”或属性“target”具有值“_internal”一起出现</td><td>Duration.datatype</td><td>none</td><td></td><td>指示处理器在分派消息之前应等待多长时间</td></tr><tr><td>delayexpr</td><td>false</td><td>不得出现在“delay”或属性“target”的值为“_internal”时</td><td>值表达式</td><td>none</td><td></td><td>“delay”的动态替代方案。如果此属性存在，SCXML 处理器必须在执行父 <code>&lt;send&gt;</code> 元素时对其进行执行，并将结果视为已作为“delay”值输入</td></tr><tr><td>namelist</td><td>false</td><td>不得与 <code>&lt;content&gt;</code> 元素一起指定</td><td>位置表达式列表</td><td>none</td><td></td><td>一个或多个数据模型位置的空格分隔列表，作为属性/值对包含在消息中。 （位置的名称是属性，存储在位置的值是值。）</td></tr></tbody></table><p>children 可以包含：</p><ul><li><code>&lt;content&gt;</code>：可以出现 0 次或 1 次。</li><li><code>&lt;param&gt;</code>：可以出现 0 次或多次。</li></ul><p>符合标准的 SCXML 文档必须准确指定“event”、“eventexpr”和 <code>&lt;content&gt;</code> 之一。符合标准的文档不得在 <code>&lt;content&gt;</code> 中指定“namelist”或 <code>&lt;param&gt;</code>。</p><ul><li>SCXML 处理器必须包含 <code>&lt;param&gt;</code> 或 &#39;namelist&#39; 提供的所有属性和值，即使出现重复也是如此。</li><li>如果存在“idlocation”，SCXML 处理器必须在执行父 <code>&lt;send&gt;</code> 元素时生成一个 id 并将其存储在此位置。</li><li>如果通过“delay”或“delayexpr”指定延迟，SCXML 处理器必须将字符串解释为时间间隔。 它必须仅在延迟间隔过去后才发送消息。 （请注意，发送标记的执行将立即返回。）处理器必须在执行 <code>&lt;send&gt;</code> 元素时执行所有参数到 <code>&lt;send&gt;</code>，而不是在实际发送消息时执行。 如果 <code>&lt;send&gt;</code> 参数的执行产生错误，处理器必须丢弃该消息而不尝试传递它。 如果 SCXML 会话在延迟间隔过去之前终止，则 SCXML 处理器必须丢弃该消息而不尝试传递它。</li></ul><p>对应 XState 的 <code>actions.send</code> 函数。结构类似：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scxml.event&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scxml.id&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;delay&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scxml.delay&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;to&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scxml.target&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态B<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态B<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;状态A&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    状态<span class="token constant">A</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;跳转&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">跳转</span><span class="token operator">:</span> <span class="token string">&quot;状态B&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    状态<span class="token constant">B</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726585203.98fad3f3.webp" alt="" loading="lazy"></p><h3 id="_3-4-2-cancel" tabindex="-1"><a class="header-anchor" href="#_3-4-2-cancel" aria-hidden="true">#</a> 3.4.2 <code>&lt;cancel&gt;</code></h3><p><code>&lt;cancel&gt;</code> 元素用于取消延迟的 <code>&lt;send&gt;</code> 事件。 SCXML 处理器不得允许 <code>&lt;cancel&gt;</code> 影响未在同一会话中引发的事件。 处理器应尽最大努力取消具有指定 ID 的所有延迟事件。 但是请注意，它不能保证成功，例如，如果事件在 <code>&lt;cancel&gt;</code> 标记执行时已经交付。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cancel</span> <span class="token attr-name">sendid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>跳转ID<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>sendid</td><td>false</td><td>不得与 sendideexpr 一起出现</td><td>IDREF</td><td>none</td><td>延迟事件的 sendid</td><td>要取消的事件的 ID。如果多个延迟事件有这个 sendid，处理器将全部取消</td></tr><tr><td>sendidexpr</td><td>false</td><td>不得与 sendid 一起出现</td><td>值表达式</td><td>none</td><td>计算结果为延迟事件 ID 的任何表达式</td><td>&#39;sendid&#39; 的动态替代方案。如果此属性存在，SCXML 处理器必须在执行父 <code>&lt;cancel&gt;</code> 元素时对其进行执行，并将结果视为已作为“sendid”的值输入</td></tr></tbody></table><p>对应 XState 的 <code>actions.cancel</code> 函数。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>未登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>未登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>已登录<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>已登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>已登录<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>活动<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>注销<span class="token punctuation">&quot;</span></span> <span class="token attr-name">delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000 * 60<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>未登录<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>消息ID<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onexit</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cancel</span> <span class="token attr-name">sendid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>消息ID<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cancel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onexit</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;未登录&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">未登录</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">登录</span><span class="token operator">:</span> <span class="token string">&quot;已登录&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">已登录</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">onEntry</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;注销&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">,</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;消息ID&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">onExit</span><span class="token operator">:</span> actions<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">&quot;消息ID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">注销</span><span class="token operator">:</span> <span class="token string">&quot;未登录&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">活动</span><span class="token operator">:</span> <span class="token string">&quot;已登录&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726608095.ac5d75cb.webp" alt="" loading="lazy"></p><p>也可以使用 XState 的 <code>after</code> 语法糖来实现：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;未登录&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">未登录</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">登录</span><span class="token operator">:</span> <span class="token string">&quot;已登录&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">已登录</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">after</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;未登录&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">on</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">活动</span><span class="token operator">:</span> <span class="token string">&quot;已登录&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726632943.0954bdb3.webp" alt="" loading="lazy"></p><h3 id="_3-4-3-invoke" tabindex="-1"><a class="header-anchor" href="#_3-4-3-invoke" aria-hidden="true">#</a> 3.4.3 <code>&lt;invoke&gt;</code></h3><p><code>&lt;invoke&gt;</code> 元素用于创建外部服务的实例。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>invoke</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ID_SUB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sub.scxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i_ID<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>invoke</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&lt;invoke&gt;</code> 提供了一种更紧密耦合的通信形式，特别是能够触发平台定义的服务并将数据传递给它。 它及其子 <code>&lt;finalize&gt;</code> 在模拟外部服务行为的状态中很有用。 <code>&lt;invoke&gt;</code> 元素在状态的 <code>&lt;onentry&gt;</code> 元素之后执行，并导致创建外部服务的实例。 <code>&lt;param&gt;</code> 和 <code>&lt;content&gt;</code> 元素以及 &#39;namelist&#39; 属性可用于将数据传递给服务。 当并行状态同时调用相同的外部服务时，将启动外部服务的单独实例。 它们可以通过与它们相关联的 id 来区分。 类似地，从外部服务返回的事件中包含的 id 可用于确定哪些事件是对哪些调用的响应。 返回的每个事件将仅由调用它的状态中的 <code>&lt;finalize&gt;</code> 处理，但该事件随后会像状态机接收的任何其他事件一样被处理。 因此，finalize 代码可以被认为是在将事件添加到事件队列之前应用的预处理阶段。 请注意，该事件将传递给所有并行状态以检查转换。 由于当状态机离开调用状态时调用将被取消，因此在将立即退出的状态下开始调用是没有意义的。 因此，<code>&lt;invoke&gt;</code> 元素在进入状态时执行，但仅在检查无事件转换和未决内部事件驱动的转换之后。 如果找到任何此类启用的转换，则立即执行该转换并立即退出该状态，而不会触发调用。 因此，只有在状态机达到稳定配置时才会触发调用，即在等待外部事件时它将停留在其中的配置。</p><p>属性字段描述如下：</p><table><thead><tr><th>名称</th><th>必填</th><th>属性约束</th><th>类型</th><th>默认值</th><th>有效值</th><th>描述</th></tr></thead><tbody><tr><td>type</td><td>false</td><td>不能与“typeexpr”属性一起出现</td><td>URI</td><td>none</td><td></td><td>指定外部服务类型的 URI</td></tr><tr><td>typeexpr</td><td>false</td><td>不得与“type”属性一起出现</td><td>值表达式</td><td>none</td><td>计算结果为 URI 的任何值表达式，该 URI 将是 &#39;type&#39; 的有效值</td><td>“type”的动态替代方案。如果此属性存在，SCXML 处理器必须在执行父 <code>&lt;invoke&gt;</code> 元素时对其进行执行，并将结果视为已作为“type”的值输入</td></tr><tr><td>src</td><td>false</td><td></td><td>URI</td><td>none</td><td></td><td>要传递给外部服务的 URI</td></tr><tr><td>srcexpr</td><td>false</td><td></td><td>值表达式</td><td>none</td><td></td><td>&#39;src&#39; 的动态替代方案。如果此属性存在，SCXML 处理器必须在执行父 <code>&lt;invoke&gt;</code> 元素时对其进行执行，并将结果视为已作为“src”的值输入</td></tr><tr><td>id</td><td>false</td><td></td><td>ID</td><td>none</td><td></td><td>要用作此 <code>&lt;invoke&gt;</code> 实例的标识符的字符串文字</td></tr><tr><td>idlocation</td><td>false</td><td></td><td>位置表达式</td><td>none</td><td></td><td>任何对数据模型位置求值的数据模型表达式</td></tr><tr><td>namelist</td><td>false</td><td></td><td>位置表达式列表</td><td>none</td><td></td><td>要作为属性/值对传递给调用服务的一个或多个数据模型位置的空格分隔列表。 （位置的名称是属性，位置存储的值是值。）</td></tr><tr><td>autoforward</td><td>false</td><td></td><td>布尔值</td><td>false</td><td></td><td>指示是否将事件转发到调用的进程的标志</td></tr></tbody></table><p>children 可以包含：</p><ul><li><code>&lt;content&gt;</code>：可以出现 0 次或 1 次。</li><li><code>&lt;param&gt;</code>：可以出现 0 次或多次。</li><li><code>&lt;finalize&gt;</code>：可以出现 0 次或 1 次。</li></ul><p>当 <code>autoforward</code> 属性设置为 true 时，SCXML 处理器必须将它接收到的每个外部事件的精确副本发送到调用的进程。SCXML 处理器必须在将事件从调用会话的外部事件队列中删除以进行处理时转发该事件。</p><p>外部服务在处理时可能会返回多个事件。如果 <code>&lt;invoke&gt;</code> 实例中有一个 <code>&lt;finalize&gt;</code> 处理程序创建了生成事件的服务，则 SCXML 处理器必须在从事件队列中删除事件以进行处理之前立即执行该 <code>&lt;finalize&gt;</code> 处理程序中的代码。它绝不能在 <code>&lt;invoke&gt;</code> 的任何其他实例中执行 <code>&lt;finalize&gt;</code> 处理程序。一旦外部服务完成处理，它必须返回一个特殊事件 <code>done.invoke.id</code> 到调用进程的外部事件队列，其中 id 是对应 <code>&lt;invoke&gt;</code> 元素的调用 ID。外部服务不得 在此完成事件之后生成任何其他事件。</p><h4 id="invoke-的实现" tabindex="-1"><a class="header-anchor" href="#invoke-的实现" aria-hidden="true">#</a> <code>&lt;invoke&gt;</code> 的实现</h4><p>包括父进程和子进程之间的通信，是特定于平台的，但是在被调用的进程本身是 SCXML 会话的情况下，以下要求成立：</p><ul><li>如果 <code>&lt;invoke&gt;</code> 中的 <code>&lt;param&gt;</code> 元素的 <code>name</code> 与调用会话的顶级数据声明中的 <code>&lt;data&gt;</code> 元素的 <code>id</code> 匹配，则 SCXML 处理器必须使用 <code>&lt;param &gt;</code> 元素作为相应 <code>&lt;data&gt;</code> 元素的初始值。（顶级数据声明是包含在 <code>&lt;scxml&gt;</code> 子元素的 <code>&lt;datamodel&gt;</code> 元素中的那些声明。）（请注意，这意味着在 <code>&lt;data&gt;</code> 元素中指定的任何值都将被忽略。） <code>namelist</code> 类似。如果名称列表中键的值与调用会话的顶级数据模型中的 <code>&lt;data&gt;</code> 元素的 <code>id</code> 匹配， scxml 处理器必须使用键的值作为相应 <code>&lt;data&gt;</code> 元素的初始值。如果名称不匹配，处理器不得 将 <code>&lt;param&gt;</code> 元素或名称列表键/值对的值添加到调用会话的数据模型中。但是，处理器可以通过其他一些特定于平台的方式使这些值可用。</li><li>当被调用的状态机达到顶级最终状态时，处理器必须放置事件 <code>done.invoke.id</code> 上调用机，其中所述外部事件队列 ID 是用于此调用的调用 ID。请注意，达到顶级最终状态对应于机器的正常终止，并且一旦处于此状态，它就无法生成或处理任何进一步的事件。</li><li>如上所述，如果调用状态机在接收到 <code>done.invoke</code> 之前退出包含调用的状态。id 事件，它取消调用的会话。执行此操作的方法是特定于平台的。然而，当它被取消时，被调用的会话必须在下一个微步结束时退出。处理器必须为被调用会话中的所有活动状态执行 <code>&lt;onexit&gt;</code> 处理程序，但它不能 生成 <code>done.invoke.id</code> 事件。一旦取消调用的会话，处理器必须忽略它从该会话接收到的任何事件。特别是它绝不能将它们插入到调用会话的外部事件队列中。</li><li>SCXML 处理器必须支持使用 SCXML 事件 I/O 处理器在调用会话和被调用会话之间进行通信。处理器可以支持使用其他事件 I/O 处理器在调用会话和被调用会话之间进行通信。</li></ul><p>对应 XState State Node 的 <code>invoke</code> 属性。描述如下：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;autoForward&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;onDone&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;onError&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>等待中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>等待中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>done.invoke.子状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>时间到<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>invoke</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>子状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/TR/scxml/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>content</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>分钟子状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>等待中<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>激活中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>激活中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>60s<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>结束<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完成<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>结束<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完成<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>content</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>invoke</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>时间到<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> minuteMachine <span class="token operator">=</span> <span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;分钟子状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;激活中&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">激活中</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">after</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">60000</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;完成&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">完成</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;final&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;状态机&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token string">&quot;等待中&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">states</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">等待中</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">invoke</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">src</span><span class="token operator">:</span> minuteMachine<span class="token punctuation">,</span>
        <span class="token literal-property property">onDone</span><span class="token operator">:</span> <span class="token string">&quot;时间到&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">时间到</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;final&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/1662726657393.adcc3183.webp" alt="" loading="lazy"></p><h3 id="_3-4-4-finalize" tabindex="-1"><a class="header-anchor" href="#_3-4-4-finalize" aria-hidden="true">#</a> 3.4.4 <code>&lt;finalize&gt;</code></h3><p><code>&lt;finalize&gt;</code> 元素使调用会话能够使用被调用会话返回的事件中包含的数据更新其数据模型。</p><p><code>&lt;finalize&gt;</code> 包含在执行 <code>&lt;invoke&gt;</code> 后外部服务返回事件时执行的可执行内容。 在系统查找与事件匹配的转换之前应用此内容。 在可执行内容中，系统变量“_event”可用于引用正在处理的事件中包含的数据。在并行状态的情况下，仅执行原始调用状态下的 finalize 代码。 在调用期间状态机从被调用组件接收到的任何事件都由 <code>&lt;finalize&gt;</code> 处理程序在选择转换之前进行预处理。 finalize&gt; 代码用于规范化返回数据的形式，并在执行转换的“event”和“cond”子句之前更新数据模型。 在符合的 SCXML 文件，在&lt;敲定&gt;的可执行内容不得引发事件或调用外部动作。特别是，<code>&lt;send&gt;</code> 和 <code>&lt;raise&gt;</code> 元素 不得出现。</p><p>children 可以包含 可执行内容。</p><p>XState 没有对应的 API，XState 对于处理消息是非常灵活的，所以这一块能力是内置进去的。</p><p>示例：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>等待中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>datamodel</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarValue<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>datamodel</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>state</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>等待中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>childToParent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cond</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarValue==2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>结束<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>invoke</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>子状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/TR/scxml/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>content</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送消息到父级子状态机<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2005/07/scxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完成<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initial</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>激活中<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>完成<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onentry</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>send</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#_parent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>childToParent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aParam<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>send</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onentry</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>content</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalize</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assign</span> <span class="token attr-name">location</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>VarValue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_event.data.aParam<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalize</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>invoke</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>state</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>final</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>结束<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>final</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scxml</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-5-未对应-xstate-api" tabindex="-1"><a class="header-anchor" href="#_3-5-未对应-xstate-api" aria-hidden="true">#</a> 3.5 未对应 XState API</h2><p>上面按照规范与 XState 进行了对应。还有一部分是 XState 特色产物。如下：</p><ul><li>Actor：Actor 模型，一套非常成熟的模型。用来扩展子状态机。</li><li>Interpreter：由于 XState 的状态机是一套纯函数编写，无任何副作用。所以官方提供了一个 Interpreter 用来托管副作用。</li><li>Model：用来改善开发人员体验，分离和组织 context 和 event，共享模型。</li></ul><h2 id="_3-6-对应大图" tabindex="-1"><a class="header-anchor" href="#_3-6-对应大图" aria-hidden="true">#</a> 3.6 对应大图</h2><p>整个对应关系，大致如下图所示： <img src="/blog/assets/1662726673727.18c91177.webp" alt="" loading="lazy"></p><h1 id="_4-最后" tabindex="-1"><a class="header-anchor" href="#_4-最后" aria-hidden="true">#</a> 4. 最后</h1><p>连续熬了一个多星期的夜，对 SCXML 和 XState 的关系进行了梳理和对齐，最终产出了这篇 4 万 多字的文章。</p><p>做为一个 XState 的 “过来人”，这篇从规范到工具对应关系的文章，正是当初那个在入门产生疑惑时的我，最需要的东西。</p><p>也希望这篇文章可以帮助入门和使用状态机及 XState 的同学解除部分疑惑。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/lecepin/blog/edit/main/demo/src/tech/前端状态机系列：SCXML与XState对应关系.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><!----><!----></footer><!----><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.773cfef9.js" defer></script>
  </body>
</html>
